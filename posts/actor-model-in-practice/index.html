<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>액터 모델 실습 - Bongjun Jang</title><meta name="Description" content="Bongjun Jang&#39;s personal blog"><meta property="og:title" content="액터 모델 실습" />
<meta property="og:description" content="Elixir Programming Language 요즘 나의 프로그래밍 공부는 Elixir를 공부하는 데 치중되어 있다. Elixir는 강타입(Strongly typed), 동적타입(Dynamically" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bongjunjang.com/posts/actor-model-in-practice/" /><meta property="og:image" content="https://bongjunjang.com/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-29T08:54:51+09:00" />
<meta property="article:modified_time" content="2023-06-22T14:05:55+09:00" /><meta property="og:site_name" content="Bongjun Jang" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://bongjunjang.com/logo.png"/>

<meta name="twitter:title" content="액터 모델 실습"/>
<meta name="twitter:description" content="Elixir Programming Language 요즘 나의 프로그래밍 공부는 Elixir를 공부하는 데 치중되어 있다. Elixir는 강타입(Strongly typed), 동적타입(Dynamically"/>
<meta name="application-name" content="My cool site">
<meta name="apple-mobile-web-app-title" content="My cool site"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://bongjunjang.com/posts/actor-model-in-practice/" /><link rel="prev" href="https://bongjunjang.com/posts/what-runs-bitcoin-network/" /><link rel="next" href="https://bongjunjang.com/posts/2023-02-01-every-new-framework-is-new-language/" /><link rel="stylesheet" href="/css/style.min.cf6878db51c51b2d04ae155284a4403dbee8db33e16c066f954c95279c271fcd.css" integrity="sha256-z2h421HFGy0ErhVShKRAPb7o2zPhbAZvlUyVJ5wnH80="><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "액터 모델 실습",
        "inLanguage": "ko",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/bongjunjang.com\/posts\/actor-model-in-practice\/"
        },"genre": "posts","keywords": "actor model, elixir","wordcount":  2702 ,
        "url": "https:\/\/bongjunjang.com\/posts\/actor-model-in-practice\/","datePublished": "2021-11-29T08:54:51+09:00","dateModified": "2023-06-22T14:05:55+09:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Bongjun Jang"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('light' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'light' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Bongjun Jang">Bongjun Jang</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/" title="Posts"> Posts </a><a class="menu-item" href="/projects/" title="Projects"> Projects </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Bongjun Jang">Bongjun Jang</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="Posts">Posts</a><a class="menu-item" href="/projects/" title="Projects">Projects</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">액터 모델 실습</h1><h2 class="single-subtitle">Leveraging Elixir GenServer</h2><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Bongjun Jang</a></span>&nbsp;<span class="post-category">included in <a href="/categories/computer/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>computer</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2021-11-29">2021-11-29</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;2702 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;6 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#마치면서">마치면서</a></li>
    <li><a href="#참고-자료">참고 자료</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content">




  <figure>
    <div>
      <img
        srcset='
                /posts/actor-model-in-practice/elixir-lang_hua77e38e9e2544974e0eca48ff58c19e8_55382_320x0_resize_box_3.png 320w,
                /posts/actor-model-in-practice/elixir-lang_hua77e38e9e2544974e0eca48ff58c19e8_55382_600x0_resize_box_3.png 600w,
                /posts/actor-model-in-practice/elixir-lang_hua77e38e9e2544974e0eca48ff58c19e8_55382_1200x0_resize_box_3.png 2x'
        src='/posts/actor-model-in-practice/elixir-lang_hua77e38e9e2544974e0eca48ff58c19e8_55382_600x0_resize_box_3.png'
        alt="" />
    </div>
    <figcaption>
      <p>Elixir Programming Language</p>
    </figcaption>
  </figure>

<p>요즘 나의 프로그래밍 공부는 Elixir를 공부하는 데 치중되어 있다.
Elixir는 강타입(Strongly typed), 동적타입(Dynamically typed), 함수형(Functional) 프로그래밍 언어다.
컴파일(<code>elixirc</code>) 뿐 아니라 인터랙티브 쉘(<code>iex</code>)과 스크립팅(<code>exs</code>)도 지원하기 때문에
함수형 언어인 것만 제외하면 파이썬이나 루비와 같은 스크립트 언어처럼 사용할 수 있다.
실제로 문법도 루비와 매우 흡사하기 때문에 파이썬이나 루비를 배웠던 사람이라면 큰 어려움없이 흡수할 수 있다.</p>
<p>함수형 언어에 한번 빠지니 다시 돌아가기가 너무 어렵다.
Elixir 전에는 F#을 주로 썼는데 F#은 아쉬운 점이 많았다.
Pattern Matching, Active Pattern이나 Algebraic Data Type 등 언어의 기능이
매우 강력해서 원하는 로직을 구현하는 것이 아주 즐거웠지만,
실제로 시스템을 구현하기 위해 C#으로 구현된 닷넷 에코시스템에 의존해야 했기 때문이다.
F#에서 C#으로 작성된 라이브러리를 사용할 수 있기는 하지만 Interop이 부자연스럽고 불편한 점이 많았다.
게다가 F#으로 작성된 라이브러리는 완성도가 낮은 경우가 많았다.
프로젝트를 실제로 진행하기에는 껄끄러운 점이 많았던 게 사실이다.
차라리 함수형 패러다임을 기꺼이 버리고 C#을 사용하는 게 나을 지경이다.</p>
<p>한편 Elixir는 erlang을 기반으로 작성되었고
동적 타입이라는 큰 차이점을 제외하면 F#처럼 언어적 특성이 매우 뛰어나다.
Phoenix, Ecto, Oban 등 Elixir로 작성된 프레임워크가
완성도가 매우 높고 프로젝트에서 실제로 사용하기에 무리가 없다.
Python이나 Ruby를 사용한 경험이 있다면 사고의 경계를 확장하기 위해
다음 언어로 Elixir를 배우는 것은 아주 좋은 선택이 될 것 같다.</p>
<h1 id="actor-model-in-elixir">Actor Model in Elixir</h1>
<p>Elixir는 언어적 단계에서 Actor Model을 지원한다. Akka와 같은 프레임워크가 필요없다.
Actor가 필요한 Stateful 시스템을 구현한다면 Elixir만큼 편리한 언어가 없을 것이다.</p>
<p>Elixir는 기본적으로 <code>Process</code> 모듈을 통해 프로세스를 관리한다.
여기서 프로세스란 OS에서 제공되는 프로세스가 아니라 어플리케이션 레벨의 경량 프로세스를 말한다.
<code>Process</code>는 각자 상태(State), 메시지 큐(Message Queue), 메시지 전송(Message Sending) 기능을
가지고 있고 다른 프로세스와 고립되어(기본적으로 에러를 전파하지 않는다) Elixir Actor Model의 가장 기초적인 뼈대가 된다.</p>
<p>다음을 통해 <code>Process</code>를 이해해보자.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elixir" data-lang="elixir"><span style="display:flex;"><span><span style="color:#75715e"># This spawns a process which</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># print &#34;hello!&#34; and dies immediately</span>
</span></span><span style="display:flex;"><span>pid <span style="color:#f92672">=</span> spawn(<span style="color:#66d9ef">fn</span> <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">IO</span><span style="color:#f92672">.</span>puts <span style="color:#e6db74">&#34;hello!&#34;</span> <span style="color:#66d9ef">end</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># It prints &#34;hello!&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This returns `false`</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Process</span><span style="color:#f92672">.</span>alive?(pid)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># The main process itself is also a process</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># `self()` returns the pid of the calling process</span>
</span></span><span style="display:flex;"><span>mother_process <span style="color:#f92672">=</span> self()
</span></span><span style="display:flex;"><span><span style="color:#75715e"># `spawn` returns the pid of the spawned process</span>
</span></span><span style="display:flex;"><span>child <span style="color:#f92672">=</span> spawn(<span style="color:#66d9ef">fn</span> <span style="color:#f92672">-&gt;</span> send(mother_process, {self(), <span style="color:#e6db74">&#34;hi! mom&#34;</span>}) <span style="color:#66d9ef">end</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># A process can receive a message from other processes</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># with `receive` keyword</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">receive</span> <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  {<span style="color:#f92672">^</span>child, msg} <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">IO</span><span style="color:#f92672">.</span>puts <span style="color:#e6db74">&#34;A letter from the child: </span><span style="color:#e6db74">#{</span>msg<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>하지만 <code>Process</code>에는 너무 기본적인 기능만 구현되어 있어서 사용하기 쉽지 않다.
그렇기 때문에 <code>Process</code>가 서로 메시지를 주고 받을 수 있고,메시지 큐를 처리하며, 서로 고립되어 있다는 특성만 알고 넘어가자.
대신, 실제로 유용하게 사용할 수 있는 <code>Agent</code>, <code>GenServer</code>, <code>Task</code> 등을 살펴보자.
여기서는 Actor Model을 이해하는 데 유용한 <code>Agent</code>와 <code>GenServer</code>를 소개할 것이다.</p>
<h1 id="agent">Agent</h1>
<p><code>Elixir</code>의 <code>Agent</code>를 이용하면 Actor Model의 상태 관리를 쉽게 구현할 수 있다.
<code>Agent</code>는 <code>Process</code> 모듈을 이용해 상태 관리를 편리하게 만든 모듈이다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elixir" data-lang="elixir"><span style="display:flex;"><span>{<span style="color:#e6db74">:ok</span>, pid} <span style="color:#f92672">=</span> <span style="color:#a6e22e">Agent</span><span style="color:#f92672">.</span>start(<span style="color:#66d9ef">fn</span> <span style="color:#f92672">-&gt;</span> [] <span style="color:#66d9ef">end</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># The update function here returns :ok</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Agent</span><span style="color:#f92672">.</span>update(pid, <span style="color:#66d9ef">fn</span> state <span style="color:#f92672">-&gt;</span> [<span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> state] <span style="color:#66d9ef">end</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># The get function here return [1]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Agent</span><span style="color:#f92672">.</span>get(pid, <span style="color:#66d9ef">fn</span> state <span style="color:#f92672">-&gt;</span> state <span style="color:#66d9ef">end</span>)
</span></span></code></pre></div><ol>
<li><code>start</code>(또는 <code>start_link</code>): 프로세스를 주어진 초기상태와 함께 시작시킨다.</li>
<li><code>update</code>: 프로세스의 상태를 변경한다.</li>
<li><code>get</code>: 프로세스의 상태를 얻는다.</li>
</ol>
<ul>
<li>상태를 초기화하고 변경하기 위해 모두 함수가 인자로 전달되었다.</li>
<li><code>start</code>를 사용해 시작된 프로세스는 Crash가 발생할 경우 부모 프로세스에 Crash가 전파되지 않는다 그러나 <code>start_link</code>를 사용하면 부모 프로세스에 crash가 전파된다.</li>
</ul>
<p><code>Agent</code>를 이용해 간단한 스택을 관리하는 프로세스를 구현해보자.
<code>get</code>, <code>update</code>, <code>get_and_update</code>로 상태 관리를 쉽게 구현할 수 있다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elixir" data-lang="elixir"><span style="display:flex;"><span><span style="color:#66d9ef">defmodule</span> <span style="color:#a6e22e">Stack</span> <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> start_link(opts \\ []) <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Agent</span><span style="color:#f92672">.</span>start_link(<span style="color:#66d9ef">fn</span> <span style="color:#f92672">-&gt;</span> [] <span style="color:#66d9ef">end</span>, opts)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> push(pid, item) <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Agent</span><span style="color:#f92672">.</span>update(pid, <span style="color:#66d9ef">fn</span> stack <span style="color:#f92672">-&gt;</span> [item <span style="color:#f92672">|</span> stack] <span style="color:#66d9ef">end</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> pop(pid) <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Agent</span><span style="color:#f92672">.</span>get_and_update(pid, <span style="color:#f92672">&amp;</span>do_pop<span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">defp</span> do_pop([]), <span style="color:#e6db74">do</span>: {<span style="color:#66d9ef">nil</span>, []}
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">defp</span> do_pop([hd <span style="color:#f92672">|</span> tl]), <span style="color:#e6db74">do</span>: {hd, tl}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><h1 id="genserver">GenServer</h1>
<p><code>Agent</code>를 이용해 상태 관리를 위한 Actor Model를 구현했다.
하지만 <code>Agent</code> 모듈에는 Actor Model의 메시지 큐(Message Queue, 혹은 메일 박스) 개념이 잘 드러나 있지 않다.
이에 반해 <code>GenServer</code>는 Actor Model의 메시지 큐, 행동방식(Behavior)까지 쉽게 구현할 수 있게 되어있다.</p>





  <figure>
    <div>
      <img
        srcset='
                /posts/actor-model-in-practice/actor-model_huee2ed0f498179403073c8fe7d2488003_90160_320x0_resize_box_3.png 320w,
                /posts/actor-model-in-practice/actor-model_huee2ed0f498179403073c8fe7d2488003_90160_600x0_resize_box_3.png 600w,
                /posts/actor-model-in-practice/actor-model_huee2ed0f498179403073c8fe7d2488003_90160_1200x0_resize_box_3.png 2x'
        src='/posts/actor-model-in-practice/actor-model_huee2ed0f498179403073c8fe7d2488003_90160_600x0_resize_box_3.png'
        alt="" />
    </div>
    <figcaption>
      <p>Actor Model 다이어그램</p>
    </figcaption>
  </figure>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elixir" data-lang="elixir"><span style="display:flex;"><span><span style="color:#66d9ef">defmodule</span> <span style="color:#a6e22e">Stack</span> <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">use</span> <span style="color:#a6e22e">GenServer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Client API</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># This helps a client interact easily with</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># this GenServer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> start_link(opts \\ []) <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">GenServer</span><span style="color:#f92672">.</span>start_link(__MODULE__, [], opts)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> pop(server) <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">GenServer</span><span style="color:#f92672">.</span>call(server, <span style="color:#e6db74">:pop</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> push(server, item) <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">GenServer</span><span style="color:#f92672">.</span>cast(server, {<span style="color:#e6db74">:push</span>, item})
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># GenServer callbacks</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@impl</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> init(state) <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    {<span style="color:#e6db74">:ok</span>, state}
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@impl</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> handle_call(<span style="color:#e6db74">:pop</span>, _from, []]) <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    {<span style="color:#e6db74">:reply</span>, <span style="color:#66d9ef">nil</span>, []}
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@impl</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> handle_call(<span style="color:#e6db74">:pop</span>, _from, [hd <span style="color:#f92672">|</span> tl]) <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    {<span style="color:#e6db74">:reply</span>, hd, tl}
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@impl</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> handle_cast({<span style="color:#e6db74">:push</span>, item}, stack) <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    {<span style="color:#e6db74">:noreply</span>, [item <span style="color:#f92672">|</span> stack]}
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><ul>
<li><code>init</code> : 초기 상태를 정의한다.</li>
<li><code>handle_call</code> : 클라이언트의 동기 호출(Synchronous Call)을 담당한다.
<ul>
<li>Message, Caller, State를 함수 인자로 받는다.</li>
<li>Caller는 값이 반환될 때까지 대기한다(Waiting).</li>
<li><code>{:reply, Response, New State}</code>을 반환한다.</li>
</ul>
</li>
<li><code>handle_cast</code> : 클라이언트의 비동기 호출(Asynchronous Call)을 담당한다.
<ul>
<li>Message, State를 함수 인자로 받는다.</li>
<li>Caller는 값이 반환되는 것을 대기하지 않는다.</li>
<li><code>{:noreply, New State}</code>을 반환한다.</li>
</ul>
</li>
</ul>
<p>이런 방식으로 <code>GenServer</code>의 콜백함수들을 정의함으로써 메시지에 따른 Actor Model의 행동방식을 정의할 수 있다.
구체적으로 여기서 메시지는 <code>:pop</code>, <code>{:push, item}</code>이고 그에 따른 행동방식이 <code>handle_*</code> 함수 안에 정의되어 있다.
물론 먼저 들어온 순서에 따라서 메시지가 처리된다.</p>
<p><code>GenServer</code>의 강점은 이처럼 Actor Model의 구현 방식이 제시되어 있어 그 틀을 따라가기만 하면
쉽게 구현할 수 있다는 점도 있지만, Server(메시지를 받아 처리하는 측)와 Client(메시지를 보내는 측)의 코드를 분리해 구현할 수 있다는 점도 크다.
예를 들어 <code>Process</code>나 <code>Agent</code>를 사용하면 다음과 같은 코드를 작성하기 쉽다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elixir" data-lang="elixir"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> update_state(pid) <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Code here runs on the client side</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Agent</span><span style="color:#f92672">.</span>update(pid, <span style="color:#66d9ef">fn</span> state <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Code here runs on the server side</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>기능이 작동하는 데는 문제는 없으나 Client와 Server에서 작동하는 코드가 하나의 함수에 작성되기 떄문에,
구분이 불명확해져 Client와 Server의 행동을 해석하기 어렵게 만든다.
Server에 의도치않게 동기식으로 무거운 연산을 올리는 등의 실수를 유발하기 쉽다.</p>
<p><code>GenServer</code>에서의 콜백 함수는 철저히 Server에서 작동하는 코드다.
Client 측이 사용하는 함수는 위의 예제처럼 따로 작성하면 된다.
Server와 Client의 경계가 구분된 함수로 명확하게 들어나면서 시스템의 요구사항에 맞는 설계를 하기 쉬워진다.</p>
<h2 id="마치면서">마치면서</h2>
<p>Actor Model의 특성을 Elixir의 <code>Process</code>, <code>Agent</code>, <code>GenServer</code>를 통해 이해해봤다.
Actor라는 작은 단위를 이해했으니 전체 시스템을 이해하기 위해 Actor들이 서로 협력하는 법을 살펴봐야할 차례다.
Akka에서와 같이 Elixir에서도 Supervisor와 Supervision Tree 개념이 있다.
다음에는 이 부분을 살펴볼 예정이다.</p>
<h2 id="참고-자료">참고 자료</h2>
<ol>
<li>Elixir Agent: <a href="https://elixir-lang.org/getting-started/mix-otp/agent.html" target="_blank" rel="noopener noreffer ">https://elixir-lang.org/getting-started/mix-otp/agent.html</a></li>
<li>Elixir GenServer: <a href="https://elixir-lang.org/getting-started/mix-otp/genserver.html" target="_blank" rel="noopener noreffer ">https://elixir-lang.org/getting-started/mix-otp/genserver.html</a></li>
<li>Elixir GenServer: <a href="https://hexdocs.pm/elixir/GenServer.html#content" target="_blank" rel="noopener noreffer ">https://hexdocs.pm/elixir/GenServer.html#content</a></li>
</ol>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-06-22&nbsp;<a class="git-hash" href="https://github.com/dillonzq/LoveIt/commit/d508976be2f34cc44322ad2e0a4d9f9a16671972" target="_blank" title="commit by Bongjun Jang(malloc099@gmail.com) d508976be2f34cc44322ad2e0a4d9f9a16671972: rebuilding site Thu Jun 22 14:05:55 KST 2023">
                                    <i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>d508976</a></span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://bongjunjang.com/posts/actor-model-in-practice/" data-title="액터 모델 실습" data-hashtags="actor model,elixir"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://bongjunjang.com/posts/actor-model-in-practice/" data-hashtag="actor model"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://bongjunjang.com/posts/actor-model-in-practice/" data-title="액터 모델 실습"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://bongjunjang.com/posts/actor-model-in-practice/" data-title="액터 모델 실습"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://bongjunjang.com/posts/actor-model-in-practice/" data-title="액터 모델 실습"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/actor-model/">actor model</a>,&nbsp;<a href="/tags/elixir/">elixir</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/what-runs-bitcoin-network/" class="prev" rel="prev" title="비트코인을 지탱하는 원동력"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>비트코인을 지탱하는 원동력</a>
            <a href="/posts/2023-02-01-every-new-framework-is-new-language/" class="next" rel="next" title="모든 프레임워크는 새로운 언어다">모든 프레임워크는 새로운 언어다<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.115.3">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Bongjun Jang</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.b0df51c2c57145081cc73960e9aa780e6f5f56d06cf4ef0f96da8ce1619d1e12.js" integrity="sha256-sN9RwsVxRQgcxzlg6ap4Dm9fVtBs9O8PltqM4WGdHhI="></script></body>
</html>
